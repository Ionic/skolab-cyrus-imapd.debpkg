#! /bin/sh /usr/share/dpatch/dpatch-run
## 05-fix_programnames_in_manpages.dpatch by Sven Mueller <debian@incase.de>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: fix some minor things in manpages, fix program names in manpages and
## DP: program sources

@DPATCH@
--- cyrus-imapd.orig/imap/deliver.c
+++ cyrus-imapd/imap/deliver.c
@@ -113,7 +113,7 @@ static struct backend *init_net(const ch
 static void usage(void)
 {
     fprintf(stderr,
-            "421-4.3.0 usage: deliver [-C <alt_config> ] [-m mailbox]"
+            "421-4.3.0 usage: cyrdeliver [-C <alt_config> ] [-m mailbox]"
             " [-a auth] [-r return_path] [-l] [-D]\r\n");
     fprintf(stderr, "421 4.3.0 %s\n", cyrus_version());
     exit(EC_USAGE);
--- cyrus-imapd.orig/imap/quota.c
+++ cyrus-imapd/imap/quota.c
@@ -218,7 +218,7 @@ int main(int argc,char **argv)
 static void usage(void)
 {
     fprintf(stderr,
-            "usage: quota [-C <alt_config>] [-d <domain>] [-f] [-q] [prefix]...\n");
+            "usage: cyrquota [-C <alt_config>] [-d <domain>] [-f] [-q] [prefix]...\n");
     exit(EC_USAGE);
 }
 
--- cyrus-imapd.orig/imap/reconstruct.c
+++ cyrus-imapd/imap/reconstruct.c
@@ -404,7 +404,7 @@ int main(int argc, char **argv)
 static void usage(void)
 {
     fprintf(stderr,
-            "usage: reconstruct [-C <alt_config>] [-p partition] [-ksrfxu] mailbox...\n");
+            "usage: cyrreconstruct [-C <alt_config>] [-p partition] [-ksrfxu] mailbox...\n");
     fprintf(stderr, "       reconstruct [-C <alt_config>] -m\n");
     exit(EC_USAGE);
 }
--- cyrus-imapd.orig/man/chk_cyrus.8
+++ cyrus-imapd/man/chk_cyrus.8
@@ -83,4 +83,4 @@ May not be specified with -P.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/ctl_cyrusdb.8
+++ cyrus-imapd/man/ctl_cyrusdb.8
@@ -97,4 +97,4 @@ removed.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/ctl_deliver.8
+++ cyrus-imapd/man/ctl_deliver.8
@@ -77,4 +77,4 @@ Use the database specified by \fIfilenam
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/ctl_mboxlist.8
+++ cyrus-imapd/man/ctl_mboxlist.8
@@ -164,4 +164,4 @@ Use the database specified by \fIfilenam
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/cyr_expire.8
+++ cyrus-imapd/man/cyr_expire.8
@@ -182,4 +182,4 @@ only \fIexpire-days\fR is considered for
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR, \fBcyradm(1p)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR, \fBcyradm(1p)\fR
--- cyrus-imapd.orig/man/cyrus.conf.5
+++ cyrus-imapd/man/cyrus.conf.5
@@ -43,9 +43,9 @@
 cyrus.conf \- Cyrus configuration file
 .SH DESCRIPTION
 \fB/etc/cyrus.conf\fR
-is the configuration file for the Cyrus \fBmaster\fR process.  It
+is the configuration file for the Cyrus \fBcyrmaster\fR process.  It
 defines the startup procedures, services and events to be spawned by
-\fBmaster\fR.
+\fBcyrmaster\fR.
 .PP
 The \fB/etc/cyrus.conf\fR file consists of a series of entries divided
 into sections of the form
@@ -110,7 +110,7 @@ string field is required and takes one o
 \fR[ \fIhost\fR \fB: \fR] \fIport\fR
 .br
 .sp
-where \fIpath\fR is the explicit path to a UNIX socket, \fIhost\fR is
+where \fIpath\fR is the explicit (absolute) path to a UNIX socket, \fIhost\fR is
 either the hostname or bracket-enclosed IP address of a network
 interface, and \fIport\fR is either a port number or service name (as listed
 in \fB/etc/services\fR).
@@ -187,6 +187,6 @@ different modes or configurations (i.e.,
 still have separate access control rules.
 .SH SEE ALSO
 .PP
-\fBmaster(8)\fR, \fBimapd(8)\fR, \fBpop3d(8)\fR, \fBlmtpd(8)\fR,
+\fBcyrmaster(8)\fR, \fBimapd(8)\fR, \fBpop3d(8)\fR, \fBlmtpd(8)\fR,
 \fBtimsieved(8)\fR, \fBidled(8)\fR, \fBnotifyd(8)\fR, \fBctl_cyrusdb(8)\fR,
 \fBctl_deliver(8)\fR, \fBtls_prune(8)\fR, \fBhosts_access(5)\fR
--- cyrus-imapd.orig/man/deliver.8
+++ cyrus-imapd/man/deliver.8
@@ -1,5 +1,5 @@
 .\" -*- nroff -*-
-.TH DELIVER 8 "Project Cyrus" CMU
+.TH CYRDELIVER 8 "Project Cyrus" CMU
 .\"
 .\" Copyright (c) 1994-2008 Carnegie Mellon University.  All rights reserved.
 .\"
@@ -40,9 +40,9 @@
 .\" AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 .\" OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 .SH NAME
-deliver \- deliver mail to an IMAP mailbox
+cyrdeliver \- deliver mail to an IMAP mailbox
 .SH SYNOPSIS
-.B deliver
+.B cyrdeliver
 [
 .B \-C
 .I config-file
@@ -75,7 +75,7 @@ deliver \- deliver mail to an IMAP mailb
 .I userid
 ]...
 .br
-.B deliver
+.B cyrdeliver
 [
 .B \-C
 .I config-file
--- cyrus-imapd.orig/man/fud.8
+++ cyrus-imapd/man/fud.8
@@ -60,7 +60,7 @@ FUD \- provide information about user ma
 ]
 .SH DESCRIPTION
 .B FUD
-is a long lived datagram daemon started from master that provides
+is a long lived datagram daemon started from cyrmaster that provides
 information about when a user last
 read their mail, when mail last arrived in a user's mailbox, and how
 many messages are recent for that user.
--- cyrus-imapd.orig/man/idled.8
+++ cyrus-imapd/man/idled.8
@@ -55,7 +55,7 @@ mailbox changes and signals the appropri
 to report the changes to the client.
 .I Idled
 is usually started from
-.I master.
+.I cyrmaster.
 .PP
 .I Idled
 reads its configuration options out of the
@@ -74,4 +74,4 @@ Read configuration options from \fIconfi
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/imapd.8
+++ cyrus-imapd/man/imapd.8
@@ -74,7 +74,7 @@ imapd \- IMAP server process
 is an IMAP4rev1 server.
 It accepts commands on its standard input and responds on its standard output.
 It MUST be invoked by
-.IR master (8)
+.IR cyrmaster (8)
 with those descriptors attached to a remote client connection.
 .PP
 .I Imapd
@@ -153,4 +153,4 @@ some form of privacy protection.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/lmtpd.8
+++ cyrus-imapd/man/lmtpd.8
@@ -67,7 +67,7 @@ lmtpd \- LMTP server process
 is an LMTP server used to deliver mail to the IMAP mailstore.
 It accepts commands on its standard input and responds on its standard output.
 It MUST be invoked by
-.IR master (8)
+.IR cyrmaster (8)
 with those descriptors attached to a remote client connection.
 .PP
 .I Lmtpd
@@ -100,4 +100,4 @@ from trusted hosts.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/master.8
+++ cyrus-imapd/man/master.8
@@ -1,5 +1,5 @@
 .\" -*- nroff -*-
-.TH MASTER 8 "Project Cyrus" CMU
+.TH CYRMASTER 8 "Project Cyrus" CMU
 .\"
 .\" Copyright (c) 1994-2008 Carnegie Mellon University.  All rights reserved.
 .\"
@@ -40,9 +40,9 @@
 .\" AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 .\" OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 .SH NAME
-master \- master Cyrus process
+cyrmaster \- master Cyrus process
 .SH SYNOPSIS
-.B master
+.B cyrmaster
 [
 .B \-C
 .I alternate imapd.conf
@@ -78,7 +78,7 @@ master \- master Cyrus process
 .I snmp agentx socket
 ]
 .SH DESCRIPTION
-.I Master
+.I cyrmaster
 is the process that controls all of the Cyrus processes. This process
 is responsible for creating all imapd, pop3d, lmtpd and sieved child
 processes. This process also initializes the Berkeley DB code and
@@ -91,12 +91,12 @@ when it receives a SIGTERM.
 .SH OPTIONS
 .TP
 .BI \-C " alternate imapd.conf"
-Specifies an alternate imapd.conf for use by master (note that this will
-not affect any sub-processes spawned by master, you should specify those
+Specifies an alternate imapd.conf for use by cyrmaster (note that this will
+not affect any sub-processes spawned by cyrmaster, you should specify those
 specifically in the respective entries in cyrus.conf).
 .TP
 .BI \-M " alternate cyrus.conf"
-Specifies an alternate cyrus.conf for use by master.
+Specifies an alternate cyrus.conf for use by cyrmaster.
 .TP
 .BI \-l " listen queue backlog"
 Increase the listen queue backlog. By default, the listen queue is set
@@ -112,7 +112,7 @@ compiled Cyrus from its default of 10000
 .BI \-p " pidfile"
 Use
 .I pidfile
-as the pidfile.  If not specified, defaults to /var/run/cyrus-master.pid
+as the pidfile.  If not specified, defaults to /var/run/cyrmaster.pid
 .TP
 .BI \-P " snmp agentx ping interval"
 Sets the amount on time in seconds the subagent will try and reconnect to the
@@ -135,12 +135,12 @@ Address the master agent (most likely sn
 Requires net-snmp 5.0 or higher.
 .SH CONFIGURATION
 Upon execution,
-.I master
+.I cyrmaster
 reads its configuration information out of the
 .IR cyrus.conf (5)
 file.
 .PP
-.I Master
+.I cyrmaster
 rereads its configuration file when it receives a hangup signal,
 SIGHUP.  Services and events may be added, deleted or modified when the
 configuration file is reread.  Any active services removed from the
@@ -160,9 +160,18 @@ generated for processes that have not be
 The environment variable \fBCYRUS_VERBOSE\fR can be set to log additional
 debugging information. Setting the value to 1 results in base level logging.
 Setting it higher results in more log messages being generated.
+.SH BUGS
+Services do not always go away silently when removed through a SIGHUP.  If
+there are workers of the removed service still running, messages to syslog
+about broken pipes and accept() failures are to be expected.
+.PP
+The in-memory list of services is not cleaned up ever, so a cyrmaster daemon
+that has been sent an extremely high amount of SIGHUP signals to
+add/remove/modify services will lose performance eventually.  Restarting
+cyrmaster fixes this.
 .SH FILES
 .TP
-.B /etc/cyrus.conf, /etc/imapd.conf, /var/run/cyrus-master.pid
+.B /etc/cyrus.conf, /etc/imapd.conf, /var/run/cyrmaster.pid
 .SH SEE ALSO
 .PP
 \fBcyrus.conf(5)\fR, \fBimapd.conf(5)\fR, \fBimapd(8)\fR,
--- cyrus-imapd.orig/man/nntpd.8
+++ cyrus-imapd/man/nntpd.8
@@ -77,7 +77,7 @@ nntpd \- NNTP server process
 is a NNTP server.
 It accepts commands on its standard input and responds on its standard output.
 It MUST invoked by
-.IR master (8)
+.IR cyrmaster (8)
 with those descriptors attached to a remote client connection.
 .PP
 .I Nntpd
@@ -152,4 +152,4 @@ some form of privacy protection.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/notifyd.8
+++ cyrus-imapd/man/notifyd.8
@@ -61,7 +61,7 @@ notifyd \- Cyrus notification server
 ]
 .SH DESCRIPTION
 .B Notifyd
-is a daemon started from master(8) that handles notification requests on
+is a daemon started from cyrmaster(8) that handles notification requests on
 behalf of lmtpd(8).
 .B Notifyd
 accepts the request and performs the notification using the method
@@ -126,4 +126,4 @@ Default configuration file.
 Cyrus Master process configuration file.
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBcyrus.conf\fR, \fBmaster(8)\fR, \fBlmtpd(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrus.conf\fR, \fBcyrmaster(8)\fR, \fBlmtpd(8)\fR
--- cyrus-imapd.orig/man/pop3d.8
+++ cyrus-imapd/man/pop3d.8
@@ -74,7 +74,7 @@ pop3d \- POP3 server process
 is a POP3 server.
 It accepts commands on its standard input and responds on its standard output.
 It MUST invoked by
-.IR master (8)
+.IR cyrmaster (8)
 with those descriptors attached to a remote client connection.
 .PP
 .I Pop3d
@@ -131,4 +131,4 @@ some form of privacy protection.
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/quota.8
+++ cyrus-imapd/man/quota.8
@@ -1,5 +1,5 @@
 .\" -*- nroff -*-
-.TH QUOTA 8 "Project Cyrus" CMU
+.TH CYRQUOTA 8 "Project Cyrus" CMU
 .\"
 .\" Copyright (c) 1994-2008 Carnegie Mellon University.  All rights reserved.
 .\"
@@ -40,9 +40,9 @@
 .\" AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 .\" OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 .SH NAME
-quota \- report and optionally fix quota usage
+cyrquota \- report and optionally fix quota usage
 .SH SYNOPSIS
-.B quota
+.B cyrquota
 [
 .B \-C
 .I config-file
@@ -58,12 +58,12 @@ quota \- report and optionally fix quota
 .IR mailbox-prefix ...
 ]
 .SH DESCRIPTION
-.I Quota
+.I cyruota
 generates a report listing quota roots, giving their limits and usage.
 If the
 .I \-f
 option is given,
-.I quota
+.I cyrquota
 first fixes any inconsistencies in the quota subsystem, such as
 mailboxes with the wrong quota root or quota roots with the wrong
 quota usage reported.
@@ -78,14 +78,14 @@ limited to quota roots with names that s
 prefixes.
 .PP
 Running
-.I quota
+.I cyrquota
 with both the
 .I \-f
 option and
 .I mailbox-prefix
 arguments is not recommended.
 .PP
-.I Quota
+.I cyrquota
 reads its configuration options out of the
 .IR imapd.conf (5)
 file unless specified otherwise by \fB-C\fR.
--- cyrus-imapd.orig/man/reconstruct.8
+++ cyrus-imapd/man/reconstruct.8
@@ -1,5 +1,5 @@
 .\" -*- nroff -*-
-.TH RECONSTRUCT 8 "Project Cyrus" CMU
+.TH CYRRECONSTRUCT 8 "Project Cyrus" CMU
 .\"
 .\" Copyright (c) 1994-2008 Carnegie Mellon University.  All rights reserved.
 .\"
@@ -40,9 +40,9 @@
 .\" AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 .\" OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 .SH NAME
-reconstruct \- reconstruct mailboxes
+cyrreconstruct \- reconstruct mailboxes
 .SH SYNOPSIS
-.B reconstruct
+.B cyrreconstruct
 [
 .B \-C
 .I config-file
@@ -85,14 +85,14 @@ reconstruct \- reconstruct mailboxes
 .IR mailbox ...
 .br
 .br
-.B reconstruct
+.B cyrreconstruct
 [
 .B \-C
 .I config-file
 ]
 .B \-m
 .SH DESCRIPTION
-.I Reconstruct
+.I cyrreconstruct
 rebuilds one or more IMAP mailboxes.  When invoked with the
 .B \-m
 switch, it rebuilds the master
@@ -100,17 +100,17 @@ mailboxes file.  It can be used to recov
 almost any sort of data corruption.
 .PP
 If
-.I Reconstruct
+.I cyreconstruct
 can find existing header and index files, it attempts to preserve any
 data in them that is not derivable from the message files themselves.
 The state
 .I reconstruct
 attempts to preserve includes the flag names, flag state, and
 internaldate.
-.I Reconstruct
+.I cyreconstruct
 derives all other information from the message files.
 .PP
-.I Reconstruct
+.I cyreconstruct
 reads its configuration options out of the
 .IR imapd.conf (5)
 file unless specified otherwise by \fB-C\fR.  Any mailbox directory
@@ -118,12 +118,12 @@ underneath the path specified in the
 .I partition-news
 configuration option is assumed to be in news format.
 .PP
-.I Reconstruct
+.I cyrreconstruct
 does not adjust the quota usage recorded in any quota
 root files.  After running
-.IR reconstruct ,
+.IR cyrreconstruct ,
 it is advisable to run
-.IR quota (8)
+.IR cyrquota (8)
 with the
 .I \-f
 switch in order to fix the quota root files.
@@ -167,7 +167,7 @@ where problems are reported, but not fix
 .TP
 .B \-G
 Force re-parsing of the underlying message (checks GUID correctness).
-Reconstruct with -G should fix all possible individual message issues,
+cyrreconstruct with -G should fix all possible individual message issues,
 including corrupted data files.
 .TP
 .B \-R
--- cyrus-imapd.orig/man/smmapd.8
+++ cyrus-imapd/man/smmapd.8
@@ -66,7 +66,7 @@ mailbox exists, that it is postable and
 It accepts commands on its standard input and responds on its standard
 output.
 It MUST be invoked by
-.IR master (8)
+.IR cyrmaster (8)
 with those descriptors attached to a remote client connection.
 .PP
 .B SMMAPD
--- cyrus-imapd.orig/man/timsieved.8
+++ cyrus-imapd/man/timsieved.8
@@ -72,4 +72,4 @@ Read configuration options from \fIconfi
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
--- cyrus-imapd.orig/man/tls_prune.8
+++ cyrus-imapd/man/tls_prune.8
@@ -66,4 +66,4 @@ Read configuration options from \fIconfi
 .B /etc/imapd.conf
 .SH SEE ALSO
 .PP
-\fBimapd.conf(5)\fR, \fBmaster(8)\fR
+\fBimapd.conf(5)\fR, \fBcyrmaster(8)\fR
