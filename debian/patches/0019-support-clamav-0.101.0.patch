From: Debian Cyrus Team <team+cyrus@tracker.debian.org>
Date: Sat, 2 Mar 2019 14:04:58 +0000
Subject: support-clamav-0.101.0

Support for clamav-0.101.0
---
 imap/cyr_virusscan.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/imap/cyr_virusscan.c b/imap/cyr_virusscan.c
index 863a858..cfbf869 100644
--- a/imap/cyr_virusscan.c
+++ b/imap/cyr_virusscan.c
@@ -193,8 +193,12 @@ int clamav_scanfile(void *state, const char *fname,
     int r;
 
     /* scan file */
-    r = cl_scanfile(fname, virname, NULL, st->av_engine,
-                    CL_SCAN_STDOPT);
+    static struct cl_scan_options options;
+
+    memset(&options, 0, sizeof(struct cl_scan_options));
+    options.parse |= ~0; /* enable all parsers */
+
+    r = cl_scanfile(fname, virname, NULL, st->av_engine, &options);
 
     switch (r) {
     case CL_CLEAN:
